# ğŸ“ ç”¨æˆ¶éœ€æ±‚æäº¤å€

> **ä½¿ç”¨èªªæ˜**: è«‹åœ¨ä¸‹æ–¹å€å¡Šä¸­ç›´æ¥æè¿°æ‚¨çš„éœ€æ±‚ï¼Œä½¿ç”¨è‡ªç„¶èªè¨€å³å¯ã€‚Copilot Agent å°‡æœƒè‡ªå‹•å°‡æ‚¨çš„éœ€æ±‚è½‰æ›ç‚ºçµæ§‹åŒ–çš„é–‹ç™¼ä»»å‹™ã€‚

## åŸå§‹éœ€æ±‚

```
[è«‹åœ¨æ­¤è™•è¼¸å…¥æ‚¨çš„éœ€æ±‚æè¿°]

ç¯„ä¾‹ï¼š
- æˆ‘æƒ³è¦æ–°å¢ä¸€å€‹ä»»å‹™ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥è®“ä½¿ç”¨è€…å»ºç«‹ã€ç·¨è¼¯ã€åˆªé™¤ä»»å‹™
- éœ€è¦åœ¨æ–½å·¥æ—¥èªŒä¸­åŠ å…¥ç…§ç‰‡ä¸Šå‚³åŠŸèƒ½
- å¸Œæœ›èƒ½å¤ åŒ¯å‡ºæ–½å·¥é€²åº¦å ±è¡¨ç‚º PDF æ ¼å¼
```

---

## ğŸ¤– Copilot Agent è½‰æ›æŒ‡å¼•

> **âš ï¸ Copilot Agent å°ˆç”¨å€åŸŸ** - è«‹å°‡ä¸Šæ–¹ã€ŒåŸå§‹éœ€æ±‚ã€è½‰æ›ç‚ºä¸‹æ–¹çµæ§‹åŒ–æ ¼å¼

### è½‰æ›æµç¨‹

1. **ç†è§£éœ€æ±‚éšæ®µ**
   - ä»”ç´°é–±è®€ç”¨æˆ¶çš„åŸå§‹éœ€æ±‚
   - è­˜åˆ¥æ ¸å¿ƒåŠŸèƒ½é»å’Œæ¥­å‹™ç›®æ¨™
   - ç¢ºèªéœ€æ±‚çš„ç¯„åœå’Œå„ªå…ˆç´š

2. **ä½¿ç”¨å¿…è¦å·¥å…·** (MANDATORY)
   - âœ… ä½¿ç”¨ **context7** æŸ¥è©¢ç›¸é—œæŠ€è¡“æ–‡æª”å’Œæœ€ä½³å¯¦è¸
   - âœ… ä½¿ç”¨ **sequential-thinking** é€²è¡Œé‚è¼¯åˆ†æå’Œå•é¡Œæ‹†è§£
   - âœ… ä½¿ç”¨ **software-planning-tool** åˆ¶å®šå¯¦æ–½è¨ˆç•«

3. **æ ¼å¼åŒ–è¼¸å‡º**
   - å°‡éœ€æ±‚è½‰æ›ç‚ºã€Œä»»å‹™å®šç¾©ã€æ ¼å¼
   - å¡«å¯«å®Œæ•´çš„åˆ†æå’Œè¦åŠƒç« ç¯€
   - ç¢ºä¿ç¬¦åˆå°ˆæ¡ˆæ¶æ§‹è¦ç¯„

### è½‰æ›æª¢æŸ¥æ¸…å–®

#### ğŸ”§ å·¥å…·ä½¿ç”¨é©—è­‰
- [ ] å·²ä½¿ç”¨ context7 æŸ¥è©¢æŠ€è¡“æ–‡æª”
- [ ] å·²ä½¿ç”¨ sequential-thinking åˆ†æéœ€æ±‚
- [ ] å·²ä½¿ç”¨ software-planning-tool åˆ¶å®šè¨ˆç•«

#### ğŸ—ï¸ ä¸‰å±¤æ¶æ§‹åš´æ ¼åˆ†é›¢
- [ ] å·²ç¢ºèª UI å±¤ï¼ˆroutes/ï¼‰åƒ…è² è²¬å±•ç¤ºèˆ‡ä½¿ç”¨è€…äº’å‹•
- [ ] å·²ç¢ºèª Service å±¤ï¼ˆcore/services/ï¼‰è² è²¬æ¥­å‹™é‚è¼¯å”èª¿
- [ ] å·²ç¢ºèª Repository å±¤ï¼ˆcore/data-access/ï¼‰è² è²¬è³‡æ–™å­˜å–æŠ½è±¡
- [ ] å·²ç¢ºèªç„¡è·¨å±¤ç›´æ¥ä¾è³´ï¼ˆUI ä¸ç›´æ¥å‘¼å« Repositoryï¼‰

#### ğŸ“¦ Repository æ¨¡å¼å¼·åˆ¶
- [ ] ç¦æ­¢ç›´æ¥æ“ä½œ Firestoreï¼Œå¿…é ˆä½¿ç”¨ Repository æ¨¡å¼
- [ ] å·²å¯¦ä½œ Firestore Security Rules
- [ ] Repository æ”¾ç½®éµå¾ªæ±ºç­–æ¨¹ï¼ˆshared/ vs æ¨¡çµ„å°ˆå±¬ï¼‰

#### ğŸ”„ ç”Ÿå‘½é€±æœŸç®¡ç†æ¨™æº–åŒ–
- [ ] Constructionï¼šåƒ…æ³¨å…¥ä¾è³´
- [ ] Initializationï¼šåœ¨ ngOnInit ä¸­åŸ·è¡Œæ¥­å‹™é‚è¼¯
- [ ] Activeï¼šä½¿ç”¨ Signals è™•ç†éŸ¿æ‡‰å¼
- [ ] Cleanupï¼šåœ¨ ngOnDestroy ä¸­æ¸…ç†
- [ ] ç¦æ­¢åœ¨ constructor ä¸­åŸ·è¡Œæ¥­å‹™é‚è¼¯
- [ ] ç¦æ­¢åœ¨ ngOnDestroy ä¸­åŸ·è¡ŒéåŒæ­¥æ“ä½œ

#### ğŸ”— ä¸Šä¸‹æ–‡å‚³éåŸå‰‡
- [ ] å·²éµå¾ªçµ±ä¸€ä¸Šä¸‹æ–‡æ¨¡å¼ï¼šUser Context â†’ Organization Context â†’ Blueprint Context â†’ Module Context
- [ ] å·²ä½¿ç”¨ inject() æ³¨å…¥ä¸Šå±¤ä¸Šä¸‹æ–‡æœå‹™
- [ ] å·²ä½¿ç”¨ signal() ä¿å­˜ç•¶å‰ä¸Šä¸‹æ–‡ç‹€æ…‹
- [ ] ä¸Šä¸‹æ–‡è®Šæ›´æœƒè‡ªå‹•å‚³æ’­åˆ°å­å…ƒä»¶

#### ğŸ“¡ äº‹ä»¶é©…å‹•æ¶æ§‹ (Blueprint Event Bus - MANDATORY)
- [ ] ğŸš¨ æ‰€æœ‰æ¨¡çµ„é–“é€šè¨Šé€é BlueprintEventBusï¼ˆåš´ç¦ç›´æ¥ä¾è³´ï¼‰
- [ ] ğŸš¨ ç¦æ­¢æ¨¡çµ„æœå‹™ç›´æ¥æ³¨å…¥å…¶ä»–æ¨¡çµ„æœå‹™
- [ ] ğŸš¨ ç¦æ­¢è·¨æ¨¡çµ„ç›´æ¥æŸ¥è©¢ Firestore
- [ ] äº‹ä»¶å‘½åéµå¾ªè¦ç¯„ï¼š[module].[action]ï¼ˆä¾‹å¦‚ï¼štask.createdï¼‰
- [ ] ç™¼é€äº‹ä»¶åŒ…å«ï¼štypeã€blueprintIdã€timestampã€actorã€data
- [ ] è¨‚é–±äº‹ä»¶ä½¿ç”¨ takeUntilDestroyed() é€²è¡Œæ¸…ç†
- [ ] æ¯å€‹æœå‹™æ³¨å…¥ BlueprintEventBusService
- [ ] åœ¨ constructor æˆ– ngOnInit ä¸­è¨­å®šäº‹ä»¶ç›£è½å™¨

#### ğŸ§© æ¨¡çµ„æ“´å±•è¦ç¯„ï¼ˆå››éšæ®µï¼‰
- [ ] è¨»å†Šéšæ®µï¼šåœ¨ module-registry.ts è¨»å†Šæ¨¡å¡Šå®šç¾©
- [ ] å¯¦ä½œéšæ®µï¼šRepository â†’ Service â†’ Componentï¼Œæ•´åˆ Event Bus
- [ ] æ•´åˆéšæ®µï¼šè¨»å†Šè·¯ç”±èˆ‡å®ˆè¡›ï¼Œæ›´æ–° Firestore Security Rules
- [ ] æ¸¬è©¦éšæ®µï¼šå–®å…ƒæ¸¬è©¦ã€å…ƒä»¶æ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€E2E æ¸¬è©¦

#### ğŸ”’ å®‰å…¨æ€§åŸå‰‡ï¼ˆSecurity Firstï¼‰
- [ ] å·²å¯¦ä½œ Firestore Security Rules
- [ ] åœ¨å®ˆè¡›ä¸­ä½¿ç”¨ permissionService.hasRole() æª¢æŸ¥è§’è‰²
- [ ] åœ¨å…ƒä»¶ä¸­ä½¿ç”¨ permissionService.canEdit() æª¢æŸ¥æ¬Šé™
- [ ] ç¦æ­¢åœ¨å®¢æˆ¶ç«¯ä¿¡ä»»ä½¿ç”¨è€…è¼¸å…¥

#### âš¡ æ•ˆèƒ½å„ªåŒ–åŸå‰‡
- [ ] ä½¿ç”¨æ‡¶è¼‰å…¥æ¨¡å¼ï¼ˆLazy Loadingï¼‰
- [ ] ä½¿ç”¨ OnPush è®Šæ›´æª¢æ¸¬ç­–ç•¥
- [ ] ä½¿ç”¨ Firestore Snapshots é€²è¡Œå³æ™‚è³‡æ–™åŒæ­¥
- [ ] ä½¿ç”¨ computed() å¿«å–è¡ç”Ÿç‹€æ…‹ï¼Œé¿å…ä¸å¿…è¦è¨ˆç®—

#### â™¿ å¯è¨ªå•æ€§åŸå‰‡ï¼ˆAccessibilityï¼‰
- [ ] éµå¾ª WCAG 2.1 æŒ‡å—
- [ ] ä½¿ç”¨èªç¾©åŒ– HTML
- [ ] æä¾›é©ç•¶çš„ ARIA æ¨™ç±¤
- [ ] æ”¯æ´éµç›¤å°èˆª

#### ğŸš« ç¦æ­¢è¡Œç‚ºæ¸…å–®
- [ ] å·²ç¢ºèªç„¡å»ºç«‹ NgModule
- [ ] å·²ç¢ºèªç„¡ä½¿ç”¨ NgRx/Redux
- [ ] å·²ç¢ºèªç„¡å»ºç«‹ä¸å¿…è¦çš„ Facade å±¤
- [ ] å·²ç¢ºèªç„¡æ‰‹å‹•ç®¡ç†è¨‚é–±
- [ ] å·²ç¢ºèªç„¡ä½¿ç”¨ any é¡å‹
- [ ] å·²ç¢ºèªç„¡å¿½ç•¥éŒ¯èª¤è™•ç†
- [ ] å·²ç¢ºèªç„¡ç›´æ¥æ“ä½œ Firestore
- [ ] å·²ç¢ºèªç„¡å»ºç«‹ SQL/RLSï¼ˆä½¿ç”¨ Firestore Security Rulesï¼‰

#### ğŸ¯ æ±ºç­–æ¨¹é©—è­‰
- [ ] ç‹€æ…‹ç®¡ç†ï¼šéœ€è¦ â†’ ä½¿ç”¨ signal()ï¼›ä¸éœ€è¦ â†’ ç„¡ç‹€æ…‹
- [ ] è¡ç”Ÿç‹€æ…‹ï¼šéœ€è¦ â†’ ä½¿ç”¨ computed()ï¼›ä¸éœ€è¦ â†’ ç›´æ¥ä½¿ç”¨åŸå§‹ signal
- [ ] è¨‚é–±ç®¡ç†ï¼šéœ€è¦ â†’ ä½¿ç”¨ takeUntilDestroyed()ï¼›ä¸éœ€è¦ â†’ ä¸è¨‚é–±
- [ ] æ–°æ¨¡å¡Šï¼šéœ€è¦ â†’ éµå¾ªã€Œæ¨¡å¡Šæ“´å±•è¦ç¯„ã€ï¼›ä¸éœ€è¦ â†’ æ“´å±•ç¾æœ‰æ¨¡å¡Š
- [ ] éŒ¯èª¤è™•ç†ï¼šå¯æ¢å¾© â†’ recoverable=trueï¼›ä¸å¯æ¢å¾© â†’ recoverable=false

---

> **å·¥ä½œæµç¨‹**: ç†è§£éœ€æ±‚ â†’ æ ¼å¼åŒ–ä»»å‹™ â†’ åˆ†æ â†’ è¦åŠƒ â†’ å¯¦æ–½
---
## ğŸ¯ ä»»å‹™å®šç¾©
### åç¨±
### èƒŒæ™¯ / ç›®çš„
### éœ€æ±‚èªªæ˜
### In Scope / Out of Scope
### åŠŸèƒ½è¡Œç‚º
### è³‡æ–™ / API
- **èªªæ˜**: éœ€è¦çš„è³‡æ–™æ¨¡å‹ã€API ç«¯é»ã€Firestore é›†åˆçµæ§‹
### å½±éŸ¿ç¯„åœ
- **èªªæ˜**: åˆ—å‡ºæœƒå—å½±éŸ¿çš„æ¨¡çµ„ã€å…ƒä»¶ã€æœå‹™ã€è·¯ç”±
### é©—æ”¶æ¢ä»¶
- **èªªæ˜**: å¯æ¸¬è©¦ã€å¯é©—è­‰çš„é©—æ”¶æ¨™æº–
## ğŸ” åˆ†æéšæ®µ
> **Agent æŒ‡å¼•**: åœ¨æ­¤å€å¡Šé€²è¡ŒæŠ€è¡“åˆ†æï¼Œå¿…é ˆä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œæµç¨‹ï¼š
### æ­¥é©Ÿ 1: æŸ¥è©¢å®˜æ–¹æ–‡ä»¶ (Context7)
- **ç›®çš„**: æŸ¥è©¢Context7ç²å–æœ€æ–°æœ€ä½³å¯¦è¸
### æ­¥é©Ÿ 2: å¾ªåºæ€è€ƒåˆ†æ (Sequential Thinking)
- **ç›®çš„**: å°‡è¤‡é›œå•é¡Œæ‹†è§£æˆå¯é©—è­‰çš„æ€è€ƒæ­¥é©Ÿ
### æ­¥é©Ÿ 3: åˆ¶å®šé–‹ç™¼è¨ˆç•« (Software Planning Tool)
- **ç›®çš„**: å°‡éœ€æ±‚è½‰åŒ–ç‚ºå¯åŸ·è¡Œçš„é–‹ç™¼è¨ˆç•«

### åˆ†æè¼¸å‡ºæ ¼å¼
```markdown
## æŠ€è¡“åˆ†æ

### 1. æ¶æ§‹å½±éŸ¿åˆ†æ
- [ ] æª¢æŸ¥æ˜¯å¦ç¬¦åˆ `docs/architecture/FINAL_PROJECT_STRUCTURE.md` çµæ§‹
- [ ] ç¢ºèª Repository æ”¾ç½®ä½ç½®ï¼ˆshared/ æˆ–æ¨¡çµ„å°ˆå±¬ï¼‰
- [ ] ç¢ºèªæ˜¯å¦éœ€è¦æ–°å¢ Store æˆ–ä½¿ç”¨ç¾æœ‰ Store

### 2. ä¾è³´é—œä¿‚åˆ†æ
- [ ] è­˜åˆ¥éœ€è¦ä½¿ç”¨çš„ç¾æœ‰æœå‹™ã€Repositoryã€Store
- [ ] ç¢ºèªæ¨¡çµ„é–“ä¾è³´é—œä¿‚
- [ ] æª¢æŸ¥æ˜¯å¦éœ€è¦æ›´æ–° Firestore Security Rules

### 3. æŠ€è¡“æ–¹æ¡ˆè©•ä¼°
- [ ] è©•ä¼°ä¸åŒå¯¦ä½œæ–¹æ¡ˆçš„å„ªç¼ºé»
- [ ] é¸æ“‡æœ€ç¬¦åˆå°ˆæ¡ˆè¦ç¯„çš„æ–¹æ¡ˆ
- [ ] ç¢ºèªæŠ€è¡“å¯è¡Œæ€§

### 4. é¢¨éšªè­˜åˆ¥
- [ ] åˆ—å‡ºæ½›åœ¨æŠ€è¡“é¢¨éšª
- [ ] è©•ä¼°é¢¨éšªå½±éŸ¿ç¨‹åº¦
- [ ] åˆ¶å®šé¢¨éšªç·©è§£æªæ–½
```

## ğŸ“ è¦åŠƒéšæ®µ

> **Agent æŒ‡å¼•**: åŸºæ–¼åˆ†æçµæœï¼Œåˆ¶å®šè©³ç´°çš„å¯¦æ–½è¨ˆç•«ã€‚å¿…é ˆéµå¾ªå°ˆæ¡ˆæ¶æ§‹è¦ç¯„ã€‚

### å¯¦æ–½æ­¥é©Ÿ

#### Phase 1: æº–å‚™éšæ®µ
#### Phase 2: è³‡æ–™å±¤å¯¦ä½œ
#### Phase 3: å…ƒä»¶å¯¦ä½œ
#### Phase 4: è·¯ç”±æ•´åˆ
#### Phase 5: æ¸¬è©¦èˆ‡é©—è­‰

### æª”æ¡ˆæ¸…å–®
- **æ–°å¢æª”æ¡ˆ**:

- **ä¿®æ”¹æª”æ¡ˆ**:

## ğŸ“œ é–‹ç™¼è¦ç¯„

# è¦ç¯„:
- â­ä½¿ç”¨Context7(å³æ™‚æŸ¥è©¢ä¸¦å¼•ç”¨ã€Œå®˜æ–¹æ–‡ä»¶ã€ä½œç‚ºä¸Šä¸‹æ–‡ï¼Œé¿å…æ†‘å°è±¡æˆ–éæ™‚çŸ¥è­˜åšæ±ºç­–ã€‚)
- â­ä½¿ç”¨sequential-thinking(ç”¨ã€Œä¸€æ­¥æ¥ä¸€æ­¥ã€çš„é‚è¼¯é †åºï¼ŒæŠŠè¤‡é›œå•é¡Œæ‹†è§£æˆå¯é©—è­‰ã€å¯åŸ·è¡Œçš„æ€è€ƒæµç¨‹ã€‚)
- â­ä½¿ç”¨software-planning-tool(æŠŠéœ€æ±‚è½‰åŒ–ç‚ºã€Œå¯å¯¦ä½œçš„é–‹ç™¼è¨ˆç•«ã€ï¼Œç³»çµ±æ€§æ‹†è§£æˆä»»å‹™ã€é †åºã€é¢¨éšªèˆ‡äº¤ä»˜ç‰©ã€‚)
- â­åŸºæ–¼å¥§å¡å§†å‰ƒåˆ€å®šå¾‹
- 1ï¸âƒ£ KISS (Keep It Simple, Stupid)
- 2ï¸âƒ£ YAGNIï¼ˆYou Arenâ€™t Gonna Need Itï¼‰
- 3ï¸âƒ£ æœ€å°å¯è¡Œæ–¹æ¡ˆ(MVP / MVS)
- 4ï¸âƒ£ å–®ä¸€è·è²¬åŸå‰‡ï¼ˆSRPï¼‰
- 5ï¸âƒ£ ä½è€¦åˆã€é«˜å…§èš
- 6ï¸âƒ£ æ³•å‰‡ï¼ˆå¸•é›·æ‰˜åŸå‰‡ï¼‰
- 7ï¸âƒ£ æŠ€è¡“å‚µæ˜¯ã€Œåˆ©æ¯ã€ä¸æ˜¯ã€Œç½ªæƒ¡ã€
- 8ï¸âƒ£ å¯è®€æ€§ > è°æ˜ 
- 9ï¸âƒ£å¤±æ•—è¦å¯æ§ï¼ˆFail Fast, Fail Safeï¼‰
- â­è—åœ–å…§æ‰€æœ‰æ¨¡çµ„éƒ½å¿…é ˆé€éEvents (äº‹ä»¶ç¸½ç·š)äº¤äº’
- â­æ“´å±•éœ€åŸºæ–¼docs\architecture\FINAL_PROJECT_STRUCTURE.mdçµæ§‹

### ğŸ”— å°ˆæ¡ˆç‰¹å®šè¦ç¯„

#### â­ Blueprint æ¨¡çµ„äº‹ä»¶é€šè¨Š (MANDATORY)

**æ ¸å¿ƒåŸå‰‡**: ğŸš¨ **è—åœ–å…§æ‰€æœ‰æ¨¡çµ„é–“é€šè¨Šå¿…é ˆé€é BlueprintEventBusï¼Œåš´ç¦ç›´æ¥ä¾è³´**

```mermaid
graph TB
    subgraph "Blueprint Context è—åœ–ä¸Šä¸‹æ–‡"
        EB[BlueprintEventBus<br/>äº‹ä»¶ç¸½ç·š]
        
        subgraph "Business Modules æ¥­å‹™æ¨¡çµ„"
            Contract[Contract<br/>åˆç´„æ¨¡çµ„]
            Task[Task<br/>ä»»å‹™æ¨¡çµ„]
            Log[Log<br/>æ–½å·¥æ—¥èªŒ]
            QC[QC<br/>å“ç®¡æ¨¡çµ„]
            Defect[Defect<br/>ç¼ºå¤±æ¨¡çµ„]
            Acceptance[Acceptance<br/>é©—æ”¶æ¨¡çµ„]
            Issue[Issue<br/>å•é¡Œæ¨¡çµ„]
            Warranty[Warranty<br/>ä¿å›ºæ¨¡çµ„]
            Finance[Finance<br/>è²¡å‹™æ¨¡çµ„]
        end
    end
    
    Contract -->|emit events| EB
    Task -->|emit events| EB
    Log -->|emit events| EB
    QC -->|emit events| EB
    Defect -->|emit events| EB
    Acceptance -->|emit events| EB
    Issue -->|emit events| EB
    Warranty -->|emit events| EB
    Finance -->|emit events| EB
    
    EB -->|subscribe| Contract
    EB -->|subscribe| Task
    EB -->|subscribe| Log
    EB -->|subscribe| QC
    EB -->|subscribe| Defect
    EB -->|subscribe| Acceptance
    EB -->|subscribe| Issue
    EB -->|subscribe| Warranty
    EB -->|subscribe| Finance
    
    style EB fill:#f96,stroke:#333,stroke-width:4px
    style Contract fill:#bbf,stroke:#333,stroke-width:2px
    style Task fill:#bbf,stroke:#333,stroke-width:2px
    style Log fill:#bbf,stroke:#333,stroke-width:2px
    style QC fill:#bbf,stroke:#333,stroke-width:2px
    style Defect fill:#bbf,stroke:#333,stroke-width:2px
    style Acceptance fill:#bbf,stroke:#333,stroke-width:2px
    style Issue fill:#bbf,stroke:#333,stroke-width:2px
    style Warranty fill:#bbf,stroke:#333,stroke-width:2px
    style Finance fill:#bbf,stroke:#333,stroke-width:2px
```

##### ğŸš« ç¦æ­¢æ¨¡å¼ (Anti-Patterns)
```typescript
// âŒ ç¦æ­¢: æ¨¡çµ„é–“ç›´æ¥ä¾è³´
@Injectable({ providedIn: 'root' })
export class TaskService {
  private logService = inject(LogService);  // âŒ ç›´æ¥æ³¨å…¥å…¶ä»–æ¨¡çµ„æœå‹™
  
  async completeTask(taskId: string): Promise<void> {
    await this.repository.update(taskId, { status: 'completed' });
    await this.logService.createLog({ taskId });  // âŒ ç›´æ¥å‘¼å«å…¶ä»–æ¨¡çµ„
  }
}

// âŒ ç¦æ­¢: æ¨¡çµ„é–“è³‡æ–™åº«äº’ç›¸æŸ¥è©¢
@Injectable({ providedIn: 'root' })
export class AcceptanceService {
  private firestore = inject(Firestore);
  
  async checkTaskStatus(taskId: string): Promise<boolean> {
    const taskDoc = await getDoc(doc(this.firestore, 'tasks', taskId));  // âŒ è·¨æ¨¡çµ„æŸ¥è©¢
    return taskDoc.data()?.status === 'completed';
  }
}
```

##### âœ… æ­£ç¢ºæ¨¡å¼ (Correct Patterns)
```typescript
// âœ… æ­£ç¢º: é€é EventBus ç™¼é€äº‹ä»¶
@Injectable({ providedIn: 'root' })
export class TaskService {
  private eventBus = inject(BlueprintEventBusService);
  private blueprintContext = inject(BlueprintContextService);
  
  async completeTask(taskId: string): Promise<void> {
    const task = await this.repository.update(taskId, { status: 'completed' });
    
    // ç™¼é€é ˜åŸŸäº‹ä»¶
    this.eventBus.emit({
      type: 'task.completed',
      blueprintId: task.blueprintId,
      timestamp: new Date(),
      actor: this.userContext.currentUser()?.id,
      data: {
        taskId: task.id,
        taskName: task.name,
        completedAt: new Date(),
        workItemId: task.workItemId
      }
    });
  }
}

// âœ… æ­£ç¢º: è¨‚é–±äº‹ä»¶ä¸¦å›æ‡‰
@Injectable({ providedIn: 'root' })
export class LogService {
  private eventBus = inject(BlueprintEventBusService);
  private destroyRef = inject(DestroyRef);
  
  constructor() {
    this.setupEventListeners();
  }
  
  private setupEventListeners(): void {
    this.eventBus.on('task.completed')
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe(event => {
        this.autoCreateLog(event.data);
      });
  }
  
  private async autoCreateLog(data: any): Promise<void> {
    const log = await this.repository.create({
      blueprintId: data.blueprintId,
      taskId: data.taskId,
      type: 'auto_generated',
      content: `ä»»å‹™ ${data.taskName} å·²å®Œæˆ`,
      createdAt: new Date()
    });
    
    // ç¹¼çºŒç™¼é€äº‹ä»¶çµ¦ä¸‹æ¸¸
    this.eventBus.emit({
      type: 'log.created',
      blueprintId: data.blueprintId,
      timestamp: new Date(),
      data: { logId: log.id, taskId: data.taskId }
    });
  }
}
```

##### ğŸ“‹ äº‹ä»¶å‘½åè¦ç¯„
- **æ ¼å¼**: `[module].[action]`
- **ç¯„ä¾‹**: 
  - `contract.activated` - åˆç´„ç”Ÿæ•ˆ
  - `task.completed` - ä»»å‹™å®Œæˆ
  - `log.created` - æ—¥èªŒå»ºç«‹
  - `qc.passed` / `qc.failed` - QC çµæœ
  - `acceptance.passed` / `acceptance.failed` - é©—æ”¶çµæœ
  - `issue.created` / `issue.resolved` - å•é¡Œç‹€æ…‹
  - `invoice.generated` - è¨ˆåƒ¹å–®ç”¢ç”Ÿ
  - `warranty.started` - ä¿å›ºé–‹å§‹

##### ğŸ”„ æ¨¡çµ„æ•´åˆæµç¨‹ç¯„ä¾‹

**è‡ªå‹•åŒ–æµç¨‹éˆ**: Task â†’ Log â†’ QC â†’ Acceptance â†’ Invoice + Warranty

```typescript
// 1. Task å®Œæˆ â†’ è‡ªå‹•å»ºç«‹ Log
TaskService.completeTask() 
  â†’ emit('task.completed')
  â†’ LogService listens 
  â†’ auto create log
  â†’ emit('log.created')

// 2. Log å»ºç«‹ â†’ è‡ªå‹•è§¸ç™¼ QC
LogService.autoCreateLog()
  â†’ emit('log.created')
  â†’ QCService listens
  â†’ create QC record
  â†’ emit('qc.pending_created')

// 3. QC å®Œæˆ â†’ æ¢ä»¶åˆ†æ”¯
QCService.completeInspection()
  â†’ if passed: emit('qc.passed') â†’ AcceptanceService
  â†’ if failed: emit('qc.failed') â†’ DefectService

// 4. Acceptance é€šé â†’ ä¸¦è¡Œç”¢ç”Ÿ Invoice + Warranty
AcceptanceService.approve()
  â†’ emit('acceptance.passed')
  â†’ InvoiceService listens â†’ create invoice
  â†’ WarrantyService listens â†’ start warranty period
```

#### â­ Blueprint æ¶æ§‹è¦ç¯„

**æ¶æ§‹å±¤ç´š**: User Context â†’ Organization Context â†’ **Blueprint Context** â†’ Module Context

```mermaid
graph TB
    subgraph "Global Context å…¨åŸŸä¸Šä¸‹æ–‡"
        User[User Context<br/>ä½¿ç”¨è€…ä¸Šä¸‹æ–‡]
        Org[Organization Context<br/>çµ„ç¹”ä¸Šä¸‹æ–‡]
    end
    
    subgraph "Blueprint Context è—åœ–ä¸Šä¸‹æ–‡"
        BC[Blueprint Context Service<br/>è—åœ–ä¸Šä¸‹æ–‡æœå‹™]
        EB[Blueprint Event Bus<br/>è—åœ–äº‹ä»¶ç¸½ç·š]
        PM[Permission Service<br/>æ¬Šé™æœå‹™]
        
        BC -->|provides| EB
        BC -->|provides| PM
    end
    
    subgraph "Module Layer æ¨¡çµ„å±¤"
        M1[Module 1<br/>Contract]
        M2[Module 2<br/>Task]
        M3[Module 3<br/>...]
    end
    
    User -->|selects| Org
    Org -->|selects| BC
    BC -->|context| M1
    BC -->|context| M2
    BC -->|context| M3
    
    M1 -.->|events| EB
    M2 -.->|events| EB
    M3 -.->|events| EB
    
    style BC fill:#f9f,stroke:#333,stroke-width:4px
    style EB fill:#f96,stroke:#333,stroke-width:3px
```

##### Blueprint Context è·è²¬
1. **ä¸Šä¸‹æ–‡ç®¡ç†**: ä¿å­˜ç•¶å‰è—åœ–è³‡è¨Š (currentBlueprint signal)
2. **äº‹ä»¶ç¸½ç·š**: æä¾› BlueprintEventBus å¯¦ä¾‹
3. **æ¬Šé™æ§åˆ¶**: æ•´åˆ PermissionService
4. **æ¨¡çµ„éš”é›¢**: ç¢ºä¿æ¨¡çµ„é–“é€éäº‹ä»¶é€šè¨Š

##### å¯¦ä½œè¦æ±‚
```typescript
// âœ… æ¯å€‹æ¨¡çµ„æœå‹™å¿…é ˆæ³¨å…¥ BlueprintContext
@Injectable({ providedIn: 'root' })
export class TaskService {
  private blueprintContext = inject(BlueprintContextService);
  private eventBus = inject(BlueprintEventBusService);
  
  // ä½¿ç”¨ signal è¿½è¹¤ç•¶å‰è—åœ–
  currentBlueprint = computed(() => this.blueprintContext.currentBlueprint());
  
  // æ‰€æœ‰æ“ä½œé™å®šåœ¨ç•¶å‰è—åœ–å…§
  async getTasks(): Promise<Task[]> {
    const blueprintId = this.currentBlueprint()?.id;
    if (!blueprintId) throw new Error('No active blueprint');
    
    return this.repository.findByBlueprintId(blueprintId);
  }
}
```

#### â­ æ¶æ§‹çµæ§‹è¦ç¯„

æ‰€æœ‰æ“´å±•å¿…é ˆéµå¾ª `docs/architecture/FINAL_PROJECT_STRUCTURE.md` å®šç¾©çš„çµæ§‹

## âœ… æª¢æŸ¥æ¸…å–®

### ğŸ“‹ ç¨‹å¼ç¢¼å¯©æŸ¥æª¢æŸ¥é»

#### æ¶æ§‹æª¢æŸ¥
- [ ] éµå¾ªä¸‰å±¤æ¶æ§‹ï¼ˆUI â†’ Service â†’ Repositoryï¼‰
- [ ] ä½¿ç”¨ Signals é€²è¡Œç‹€æ…‹ç®¡ç†
- [ ] ä½¿ç”¨ Standalone Componentsï¼ˆç„¡ NgModulesï¼‰
- [ ] æ­£ç¢ºä½¿ç”¨ inject() æ³¨å…¥ä¾è³´

#### ä¸Šä¸‹æ–‡æª¢æŸ¥
- [ ] Blueprint Context æ­£ç¢ºå‚³é
- [ ] ä½¿ç”¨ computed() è¨ˆç®—è¡ç”Ÿç‹€æ…‹
- [ ] ä¸Šä¸‹æ–‡æ¸…ç†æ­£ç¢ºå¯¦ä½œ

#### äº‹ä»¶æª¢æŸ¥ (Blueprint Event Bus)
- [ ] ğŸš¨ æ‰€æœ‰æ¨¡çµ„é–“é€šè¨Šé€é BlueprintEventBusï¼ˆé›¶ç›´æ¥ä¾è³´ï¼‰
- [ ] ğŸš¨ ç¦æ­¢æ³¨å…¥å…¶ä»–æ¨¡çµ„çš„ Service
- [ ] ğŸš¨ ç¦æ­¢è·¨æ¨¡çµ„ Firestore æŸ¥è©¢
- [ ] æ‰€æœ‰é ˜åŸŸäº‹ä»¶é€é EventBus ç™¼é€
- [ ] äº‹ä»¶å‘½åéµå¾ªè¦ç¯„ï¼š[module].[action]
- [ ] äº‹ä»¶è¨‚é–±ä½¿ç”¨ takeUntilDestroyed()
- [ ] äº‹ä»¶åŒ…å«å®Œæ•´å…ƒæ•¸æ“š (type, blueprintId, timestamp, actor, data)

#### éŒ¯èª¤è™•ç†æª¢æŸ¥
- [ ] Service æ–¹æ³•åŒ…å« try-catch
- [ ] æ‹‹å‡ºé¡å‹åŒ–éŒ¯èª¤
- [ ] UI ä½¿ç”¨ Error Boundary Component
- [ ] éŒ¯èª¤åˆ†ç´šæ­£ç¢ºè¨­å®š

#### ç”Ÿå‘½é€±æœŸæª¢æŸ¥
- [ ] ç¦æ­¢åœ¨ constructor åŸ·è¡Œæ¥­å‹™é‚è¼¯
- [ ] ä½¿ç”¨ takeUntilDestroyed() ç®¡ç†è¨‚é–±
- [ ] æ‰‹å‹•è³‡æºæ¸…ç†åœ¨ ngOnDestroy

#### æ–‡æª”æª¢æŸ¥
- [ ] æ›´æ–°æˆ–å»ºç«‹æ¨¡å¡Š AGENTS.md
- [ ] ç¨‹å¼ç¢¼åŒ…å« JSDoc è¨»è§£
- [ ] è¤‡é›œé‚è¼¯æœ‰æ–‡å­—èªªæ˜

#### æ¸¬è©¦æª¢æŸ¥
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
- [ ] é—œéµæ¥­å‹™é‚è¼¯æœ‰æ¸¬è©¦
- [ ] E2E æ¸¬è©¦æ¶µè“‹ä¸»è¦æµç¨‹

### ğŸ’ ç¨‹å¼ç¢¼å“è³ª
- [ ] TypeScript åš´æ ¼æ¨¡å¼ç„¡éŒ¯èª¤
- [ ] ESLint æª¢æŸ¥é€šé
- [ ] ç„¡ä½¿ç”¨ any é¡å‹
- [ ] å‘½åæ¸…æ™°ä¸”ç¬¦åˆè¦ç¯„

### ğŸ›ï¸ æ¶æ§‹ç¬¦åˆæ€§
- [ ] éµå¾ªä¸‰å±¤æ¶æ§‹åˆ†é›¢ (UI â†’ Service â†’ Repository)
- [ ] Repository æ¨¡å¼æ­£ç¢ºå¯¦ä½œ
- [ ] ğŸš¨ Blueprint Event Bus å¼·åˆ¶ä½¿ç”¨ï¼ˆæ¨¡çµ„é–“é›¶ç›´æ¥ä¾è³´ï¼‰
- [ ] äº‹ä»¶é©…å‹•æ¶æ§‹æ­£ç¢ºä½¿ç”¨
- [ ] Blueprint Context æ­£ç¢ºå‚³é
- [ ] ä¸Šä¸‹æ–‡å‚³éæ¨¡å¼æ­£ç¢º

### âœ¨ åŠŸèƒ½å®Œæ•´æ€§
- [ ] åŠŸèƒ½éœ€æ±‚å®Œæ•´å¯¦ä½œ
- [ ] é‚Šç•Œæƒ…æ³è™•ç†å®Œæ•´
- [ ] éŒ¯èª¤è™•ç†å®Œæ•´
- [ ] æ¬Šé™æª¢æŸ¥å®Œæ•´

### ğŸ“– æ–‡æª”å®Œæ•´æ€§
- [ ] README æˆ– AGENTS.md å·²æ›´æ–°
- [ ] API æ–‡æª”å®Œæ•´
- [ ] æ¶æ§‹åœ–å·²æ›´æ–°ï¼ˆå¦‚æœ‰è®Šæ›´ï¼‰
- [ ] è®Šæ›´æ—¥èªŒå·²è¨˜éŒ„
