# è—åœ–å±¤æ¶æ§‹è¨­è¨ˆæ–‡æª” (Blueprint Layer)

> æ–‡ä»¶ç‰ˆæœ¬: 3.23.0  
> æ›´æ–°æ—¥æœŸ: 2025-12-16  
> æ–‡ä»¶æ€§è³ª: è·¨æ¨¡çµ„æµç¨‹èˆ‡ç³»çµ±è¦å‰‡å®šç¾©

---

## ç›®éŒ„

1. [Blueprint Layer è¨­è¨ˆ](#ä¸€blueprint-layer-è¨­è¨ˆ)
2. [å·¥ä½œæµç¨‹å®šç¾©](#äºŒå·¥ä½œæµç¨‹å®šç¾©)
3. [Blueprint Layer å®Œæ•´éª¨æ¶](#ä¸‰blueprint-layer-å®Œæ•´éª¨æ¶)

---

## ä¸€ã€Blueprint Layer è¨­è¨ˆ

> Blueprint Layer æä¾›è·¨æ¨¡çµ„çš„æµç¨‹èƒ½åŠ›èˆ‡ç³»çµ±è¦å‰‡ï¼Œä¸æ‰¿è¼‰ä»»ä½•æ¥­å‹™èªæ„ã€ä¸æ“æœ‰ Domain ç‹€æ…‹ã€ä¸å–ä»£æ¨¡çµ„æ±ºç­–ã€‚

### 1.1 Blueprint å±¤ç¸½çµå°ç…§è¡¨

| è³‡æ–™å¤¾ | å›ç­”çš„å•é¡Œ | æœ‰ç‹€æ…‹ | æœ‰æ¥­å‹™èªæ„ |
|--------|-----------|--------|-----------|
| event-bus | ç™¼ç”Ÿäº†ä»€éº¼ | âŒ | âŒ |
| workflow | ä¸‹ä¸€æ­¥æ˜¯ä»€éº¼ | âš ï¸ï¼ˆæµç¨‹ç‹€æ…‹ï¼‰ | âŒ |
| audit | ç™¼ç”Ÿéä»€éº¼ | âœ…ï¼ˆæ­·å²ï¼‰ | âŒ |
| policies | å¯ä¸å¯ä»¥ | âŒ | âš ï¸ï¼ˆè¦å‰‡ï¼‰ |

### 1.2 `/blueprint/event-bus`

**ä¸€å¥è©±å®šä½ï¼š**
> ç³»çµ±äº‹ä»¶çš„å‚³éèˆ‡åˆ†ç™¼ä¸­æ¨ï¼ˆä¸åŒ…å«æ¥­å‹™é‚è¼¯ï¼‰

**æ ¸å¿ƒè·è²¬ï¼š**

æä¾›äº‹ä»¶çš„ï¼š
- ç™¼ä½ˆï¼ˆemit / publishï¼‰
- è¨‚é–±ï¼ˆsubscribeï¼‰
- åˆ†æ´¾ï¼ˆdispatchï¼‰

ç¢ºä¿äº‹ä»¶ï¼š
- çµæ§‹ä¸€è‡´
- å¯è¿½è¹¤ï¼ˆCorrelation IDï¼‰
- å¯é‡è©¦ï¼ˆRetry / DLQï¼‰

**âŒ çµ•å°ä¸èƒ½åšçš„äº‹æƒ…ï¼š**
- âŒ åˆ¤æ–·ã€Œé€™å€‹äº‹ä»¶è©²ä¸è©²ç™¼ç”Ÿã€
- âŒ æ”¹å¯«äº‹ä»¶ payload
- âŒ æ ¹æ“šäº‹ä»¶å…§å®¹åŸ·è¡Œæ¥­å‹™é‚è¼¯
- âŒ ä¾è³´ä»»ä½• Domain Module

**æ ¸å¿ƒç†å¿µï¼š**
> Event Bus æ˜¯ä¸€å€‹è·¨æ¨¡çµ„çš„æµç¨‹åŸºç¤è¨­æ–½ï¼ˆProcess Infrastructureï¼‰ï¼Œè² è²¬å‚³éã€Œå·²ç™¼ç”Ÿäº‹å¯¦ã€ï¼Œä¸æ‰¿è¼‰æ¥­å‹™æ±ºç­–ã€‚

### 1.3 `/blueprint/workflow`

**ä¸€å¥è©±å®šä½ï¼š**
> è·¨æ¨¡çµ„æµç¨‹çš„ã€Œå”èª¿è€…ã€ï¼Œç”¨æ–¼é«˜é¢¨éšªæˆ–å¤šæ­¥é©Ÿæµç¨‹

**ä»€éº¼æ™‚å€™ã€Œéœ€è¦ã€ Workflowï¼š**

åªæœ‰åœ¨ä»¥ä¸‹æƒ…æ³æ‰ä½¿ç”¨ï¼š
- æ¶‰åŠå¤šå€‹æ¨¡çµ„
- ä¸­é–“æ­¥é©Ÿå¯èƒ½å¤±æ•—
- éœ€è¦è£œå„Ÿï¼ˆRollback / Sagaï¼‰
- æµç¨‹ã€Œä¸èƒ½åªé äº‹ä»¶è‡ªç„¶æ“´æ•£ã€

**ä¾‹å¦‚ï¼š**
- è«‹æ¬¾ â†’ é–‹ç¥¨ â†’ æ”¶æ¬¾ â†’ å…¥å¸³
- è§£ç´„ â†’ å›æ»¾ä»»å‹™ â†’ å›æ»¾è²¡å‹™ â†’ é€šçŸ¥

**å¯ä»¥åšçš„äº‹æƒ…ï¼š**
- è¨‚é–±å¤šå€‹äº‹ä»¶
- ç®¡ç†æµç¨‹ç‹€æ…‹ï¼ˆProcess Stateï¼‰
- ç™¼å‡ºä¸‹ä¸€æ­¥æŒ‡ä»¤å‹äº‹ä»¶
- è§¸ç™¼è£œå„Ÿäº‹ä»¶

**âŒ ä¸èƒ½åšçš„äº‹æƒ…ï¼š**
- âŒ ä¸å¾—å­˜å– Domain Repository
- âŒ ä¸å¾—æ”¹å¯« Domain ç‹€æ…‹
- âŒ ä¸å¾—å¯« UI æˆ–æ¬Šé™é‚è¼¯
- âŒ ä¸å¾—è®Šæˆæµç¨‹ä¸Šå¸

**æ­£ç¢ºå¿ƒæ³•ï¼š**
> Workflow ä¸ã€Œåšäº‹ã€ï¼Œåªã€Œæ±ºå®šæ¥ä¸‹ä¾†è¦å«èª°åšäº‹ã€ã€‚

### 1.4 `/blueprint/audit`

**ä¸€å¥è©±å®šä½ï¼š**
> ç³»çµ±è¡Œç‚ºçš„ä¸å¯è®Šæ­·å²ç´€éŒ„å±¤

**æ ¸å¿ƒè·è²¬ï¼š**

è¨˜éŒ„æ‰€æœ‰ï¼š
- æ‰‹å‹•æ“ä½œ
- é‡è¦ç‹€æ…‹è®Šæ›´
- é—œéµäº‹ä»¶

æä¾›ï¼š
- äº‹å¾Œè¿½è¹¤
- ç¨½æ ¸æŸ¥è©¢
- å•è²¬ä¾æ“š

**å¯ä»¥è¨˜éŒ„çš„å…§å®¹ï¼š**
- æ“ä½œäºº
- æ“ä½œæ™‚é–“
- æ¨¡çµ„ä¾†æº
- è¡Œç‚ºé¡å‹
- ç‹€æ…‹å‰ / å¾Œ
- Correlation ID

**âŒ ä¸èƒ½åšçš„äº‹æƒ…ï¼š**
- âŒ ä¸å½±éŸ¿æµç¨‹
- âŒ ä¸é˜»æ–·æ“ä½œ
- âŒ ä¸ç•¶æˆæ¥­å‹™è³‡æ–™ä¾†æº
- âŒ ä¸å›å¯« Domain

**å¸¸è¦‹èª¤ç”¨ï¼š**
> âŒ ç”¨ Audit Log ç•¶ä½œã€Œæµç¨‹åˆ¤æ–·ä¾æ“šã€  
> ğŸ‘‰ Audit æ˜¯æ­·å²ï¼Œä¸æ˜¯çœŸç›¸ä¾†æº

### 1.5 `/blueprint/policies`

**ä¸€å¥è©±å®šä½ï¼š**
> è·¨æ¨¡çµ„çš„ä¸€è‡´æ€§è¦å‰‡èˆ‡é™åˆ¶æ¢ä»¶

**é©åˆæ”¾åœ¨ Policy çš„æ±è¥¿ï¼š**
- ç‹€æ…‹è½‰æ›è¦å‰‡
- æ“ä½œå‰ç½®æ¢ä»¶
- è§’è‰² / æ¬Šé™çŸ©é™£ï¼ˆé‚è¼¯å±¤ï¼‰
- ç³»çµ±ç´š Guard

**ä¾‹å¦‚ï¼š**
- æœªç”Ÿæ•ˆåˆç´„ä¸å¯å»ºç«‹ä»»å‹™
- é©—æ”¶æœªé€šéä¸å¯è«‹æ¬¾
- å·²çµæ¡ˆå•é¡Œä¸å¯å†ç·¨è¼¯

**å¯ä»¥åšçš„äº‹æƒ…ï¼š**
- æä¾›ç´”é‚è¼¯åˆ¤æ–·
- è¤‡ç”¨é©—è­‰ç¢¼

```typescript
canCreateTask(contract): boolean
```

- è¢«å¤šå€‹æ¨¡çµ„å…±ç”¨
- ä¸ä¾è³´ UI / DB

**âŒ ä¸èƒ½åšçš„äº‹æƒ…ï¼š**
- âŒ ä¸å­˜è³‡æ–™
- âŒ ä¸ç™¼äº‹ä»¶
- âŒ ä¸åŸ·è¡Œæµç¨‹
- âŒ ä¸è™•ç†ä¾‹å¤–æµç¨‹

**å¿ƒæ³•ä¸€å¥è©±ï¼š**
> Policy å›ç­”çš„æ˜¯ï¼šã€Œå¯ä¸å¯ä»¥ã€ï¼Œä¸æ˜¯ï¼šã€Œæ€éº¼åšã€

---

## äºŒã€å·¥ä½œæµç¨‹å®šç¾©

### 2.1 åˆç´„å»ºç«‹èˆ‡ä¾†æºæµç¨‹

```
åˆç´„ä¸Šå‚³ï¼ˆPDF / åœ–æª”ï¼‰ã€æ‰‹å‹•ã€‘
â†“
åˆç´„å»ºæª”ï¼ˆåŸºæœ¬è³‡æ–™ã€æ¥­ä¸»ã€æ‰¿å•†ï¼‰ã€æ‰‹å‹•ã€‘
â†“
åˆç´„è§£æï¼ˆOCR / AI è§£ææ¢æ¬¾ã€é‡‘é¡ã€å·¥é …ï¼‰ã€è‡ªå‹•ã€‘
â†“
åˆç´„ç¢ºèªï¼ˆç¢ºèªè§£æçµæœæˆ–äººå·¥è£œé½Šï¼‰ã€æ‰‹å‹•ã€‘
â†“
åˆç´„ç‹€æ…‹ï¼šå¾…ç”Ÿæ•ˆ
â†“
åˆç´„ç”Ÿæ•ˆï¼ˆåƒ…å·²ç”Ÿæ•ˆåˆç´„å¯å»ºç«‹ä»»å‹™ï¼‰ã€æ‰‹å‹•ã€‘
```

### 2.2 ä»»å‹™èˆ‡æ–½å·¥éšæ®µ

```
ä»»å‹™å»ºç«‹ï¼ˆé—œè¯åˆç´„ / å·¥é … / é‡‘é¡ï¼‰ã€æ‰‹å‹•ã€‘
â†“
æŒ‡æ´¾ä½¿ç”¨è€…æˆ–åœ˜éšŠã€æ‰‹å‹•ã€‘
â†“
æ–½å·¥åŸ·è¡Œ
â†“
æå ±å®Œæˆã€æ‰‹å‹•ã€‘
â†“
ç®¡ç†ç¢ºèªå®Œæˆã€æ‰‹å‹•ã€‘
```

> æ­¤ç¯€é»åƒ…ç¢ºèªæ–½å·¥è²¬ä»»å®Œæˆï¼Œä¸ç­‰åŒæ–¼é©—æ”¶å®Œæˆ

### 2.3 å“è³ªèˆ‡é©—æ”¶éšæ®µ

```
è‡ªå‹•å»ºç«‹æ–½å·¥æ—¥èªŒã€è‡ªå‹•ã€‘
â†“
è‡ªå‹•å»ºç«‹ QC å¾…é©—ã€è‡ªå‹•ã€‘
â†“
QC é€šéï¼Ÿ
```

**QC åˆ¤å®šæµç¨‹ï¼š**

- **å¦**
  ```
  å»ºç«‹ç¼ºå¤±å–®ã€è‡ªå‹•ã€‘
  â†“
  æ•´æ”¹ã€æ‰‹å‹•ã€‘
  â†“
  è¤‡é©—ã€æ‰‹å‹•ã€‘
  â†“
  å›åˆ° QC åˆ¤å®š
  ```

- **æ˜¯**
  ```
  â†“
  é©—æ”¶ã€æ‰‹å‹•ã€‘
  ```

**é©—æ”¶åˆ¤å®šæµç¨‹ï¼š**

é©—æ”¶é€šéï¼Ÿ

- **å¦**
  ```
  å»ºç«‹å•é¡Œå–®ã€å¯æ‰‹å‹• / å¯è‡ªå‹•ã€‘
  â†“
  å•é¡Œè™•ç†ã€æ‰‹å‹•ã€‘
  â†“
  å›åˆ°é©—æ”¶
  ```

- **æ˜¯**
  ```
  â†“
  é©—æ”¶è³‡æ–™å°å­˜ã€è‡ªå‹•ã€‘
  â†“
  é€²å…¥ä¿å›ºæœŸã€è‡ªå‹•ã€‘
  ```

### 2.4 ä¿å›ºæœŸç®¡ç†æµç¨‹

**ä¿å›ºæœŸé–“ï¼š**

ç™¼ç”Ÿä¿å›ºç¼ºå¤±ï¼Ÿ

- **æ˜¯**
  ```
  å»ºç«‹å•é¡Œå–®ã€å¯æ‰‹å‹• / å¯è‡ªå‹•ã€‘
  â†“
  ä¿å›ºç¶­ä¿®ã€æ‰‹å‹•ã€‘
  â†“
  çµæ¡ˆã€æ‰‹å‹•ã€‘
  ```

- **å¦**
  ```
  æŒçºŒä¿å›ºç›£æ§
  ```

**ä¿å›ºæœŸæ»¿ï¼š**
```
ä¿å›ºæœŸæ»¿ã€è‡ªå‹•ã€‘
â†“
æœ€çµ‚é©—æ”¶çµæ¡ˆã€æ‰‹å‹•ã€‘
```

### 2.5 è²¡å‹™èˆ‡æˆæœ¬éšæ®µ

```
é‡‘é¡ / æ¯”ä¾‹ç¢ºèªï¼ˆå¯è«‹æ¬¾æ¯”ä¾‹ / å¯ä»˜æ¬¾æ¯”ä¾‹ï¼‰ã€æ‰‹å‹•ã€‘
â†“
å»ºç«‹å¯è«‹æ¬¾æ¸…å–® + å¯ä»˜æ¬¾æ¸…å–®ã€è‡ªå‹•ã€‘
ï¼ˆæ¥­ä¸» / æ‰¿å•†åˆ†é›¢ï¼‰
â†“
è«‹æ¬¾ / ä»˜æ¬¾æµç¨‹ã€æ‰‹å‹•ã€‘
```

**æµç¨‹ç‹€æ…‹ï¼š**
- è‰ç¨¿
- é€å‡º
- å¯©æ ¸
- é–‹ç¥¨
- æ”¶æ¬¾ / ä»˜æ¬¾

**è²¡å‹™å¯©æ ¸æµç¨‹ï¼š**

å¯©æ ¸çµæœï¼š
- é€šé â†’ ç¹¼çºŒæµç¨‹
- é€€å› â†’ è£œä»¶ â†’ ä¿®æ­£ â†’ å†æ¬¡å¯©æ ¸

**è²¡å‹™ç‹€æ…‹åŒæ­¥ï¼š**

```
æ›´æ–°ä»»å‹™æ¬¾é …ç‹€æ…‹ã€è‡ªå‹•ã€‘
```

- è«‹æ¬¾é€²åº¦ç™¾åˆ†æ¯”
- ä»˜æ¬¾é€²åº¦ç™¾åˆ†æ¯”

**æˆæœ¬èˆ‡åˆ†æï¼š**

è‡ªå‹•è¨ˆå…¥æˆæœ¬ç®¡ç†ï¼š
- å¯¦éš›æˆæœ¬
- æ‡‰æ”¶é‡‘é¡
- æ‡‰ä»˜é‡‘é¡
- æ¯›åˆ©èˆ‡æˆæœ¬åˆ†æ

### 2.6 å•é¡Œå–®ï¼ˆIssueï¼‰è¨­è¨ˆåŸå‰‡

- å•é¡Œå–®ç‚º **ç¨ç«‹æ¨¡çµ„**
- ä¸å°ˆå±¬æ–¼é©—æ”¶æµç¨‹
- å¯ç”±å¤šä¾†æºå»ºç«‹
- å…·å‚™å®Œæ•´ç”Ÿå‘½é€±æœŸ

**å•é¡Œå–®ç”Ÿå‘½é€±æœŸï¼š**
```
open â†’ in_progress â†’ resolved â†’ verified â†’ closed
```

**å•é¡Œå–®å»ºç«‹ä¾†æºï¼ˆæ¦‚å¿µï¼‰ï¼š**
- é©—æ”¶å¤±æ•—
- QC æª¢é©—å¤±æ•—
- ä¿å›ºç¼ºå¤±
- å®‰å…¨äº‹ä»¶
- ä½¿ç”¨è€…æ‰‹å‹•å»ºç«‹

### 2.7 äº‹ä»¶èˆ‡è‡ªå‹•åŒ–åŸå‰‡

- æ‰€æœ‰è‡ªå‹•æµç¨‹çš†ç”± **äº‹ä»¶æˆ– Queue è§¸ç™¼**
- ç‹€æ…‹æ”¹è®Šå³ç”¢ç”Ÿäº‹ä»¶
- äº‹ä»¶ä¸åŒ…å« UI æˆ–ä½¿ç”¨è€…äº’å‹•é‚è¼¯

### 2.8 ç¨½æ ¸èˆ‡æ¬Šé™æ§åˆ¶

**Audit Logï¼ˆå¿…è¦ï¼‰ï¼š**

æ‰€æœ‰ã€æ‰‹å‹•ã€‘ç¯€é»éœ€è¨˜éŒ„ï¼š
- æ“ä½œäºº
- æ“ä½œæ™‚é–“
- ç‹€æ…‹è®Šæ›´å‰å¾Œ
- å‚™è¨»æˆ–åŸå› 

**æ¬Šé™è¨­è¨ˆï¼š**
- ä¸åŒè§’è‰²å¯æ“ä½œä¸åŒç¯€é»
- æ¬Šé™ä¸ç¡¬ç·¨ç¢¼æ–¼ UI
- ç”±æ¨¡çµ„å±¤æˆ–æ”¿ç­–å±¤æ§ç®¡

---

## ä¸‰ã€Blueprint Layer å®Œæ•´éª¨æ¶

### 3.1 ç›®éŒ„çµæ§‹

```
/blueprint
â”œâ”€ modules/
â”‚  â”œâ”€ contract/
â”‚  â”‚  â”œâ”€ models/                  # Aggregate / Value Objects
â”‚  â”‚  â”‚  â””â”€ index.ts
â”‚  â”‚  â”œâ”€ states/
â”‚  â”‚  â”‚  â””â”€ contract.states.ts
â”‚  â”‚  â”œâ”€ services/
â”‚  â”‚  â”‚  â””â”€ contract.service.ts
â”‚  â”‚  â”œâ”€ repositories/
â”‚  â”‚  â”‚  â”œâ”€ contract.repository.ts
â”‚  â”‚  â”‚  â””â”€ contract.repository.impl.ts
â”‚  â”‚  â”œâ”€ events/
â”‚  â”‚  â”‚  â””â”€ contract.events.ts
â”‚  â”‚  â”œâ”€ policies/
â”‚  â”‚  â”‚  â””â”€ contract.policies.ts
â”‚  â”‚  â”œâ”€ facade/
â”‚  â”‚  â”‚  â””â”€ contract.facade.ts
â”‚  â”‚  â”œâ”€ config/
â”‚  â”‚  â”‚  â””â”€ contract.config.ts
â”‚  â”‚  â”œâ”€ module.metadata.ts
â”‚  â”‚  â”œâ”€ contract.module.ts
â”‚  â”‚  â””â”€ README.md
â”‚  â”‚
â”‚  â”œâ”€ task/
â”‚  â”‚  â””â”€ ... (åŒ contract)
â”‚  â”‚
â”‚  â”œâ”€ issue/
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ acceptance/
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ finance/
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â””â”€ warranty/
â”‚     â””â”€ ...
â”‚
â”œâ”€ asset/
â”‚  â”œâ”€ models/
â”‚  â”‚  â””â”€ asset.entity.ts
â”‚  â”œâ”€ states/
â”‚  â”‚  â””â”€ asset.states.ts
â”‚  â”œâ”€ services/
â”‚  â”‚  â”œâ”€ asset.service.ts
â”‚  â”‚  â””â”€ asset-upload.service.ts
â”‚  â”œâ”€ repositories/
â”‚  â”‚  â””â”€ asset.repository.ts
â”‚  â”œâ”€ events/
â”‚  â”‚  â””â”€ asset.events.ts
â”‚  â”œâ”€ policies/
â”‚  â”‚  â””â”€ asset.policies.ts
â”‚  â”œâ”€ facade/
â”‚  â”‚  â””â”€ asset.facade.ts
â”‚  â”œâ”€ config/
â”‚  â”‚  â””â”€ asset.config.ts
â”‚  â”œâ”€ module.metadata.ts
â”‚  â”œâ”€ asset.module.ts
â”‚  â””â”€ README.md
 
â”œâ”€ ai-facade/
â”‚  â”œâ”€ adapters/
â”‚  â”‚  â””â”€ index.ts
â”‚  â”œâ”€ facade/
â”‚  â”‚  â””â”€ ai.facade.ts
â”‚  â”œâ”€ ai.types.ts
â”‚  â””â”€ README.md

â”œâ”€ analytics/
â”‚  â”œâ”€ metrics/
â”‚  â”‚  â””â”€ metrics.service.ts
â”‚  â”œâ”€ reports/
â”‚  â”‚  â””â”€ report.generator.ts
â”‚  â”œâ”€ analytics.service.ts
â”‚  â””â”€ README.md

â”œâ”€ notification/
â”‚  â”œâ”€ channels/
â”‚  â”‚  â”œâ”€ email.channel.ts
â”‚  â”‚  â””â”€ push.channel.ts
â”‚  â”œâ”€ notification.service.ts
â”‚  â”œâ”€ templates/
â”‚  â”‚  â””â”€ default.template.ts
â”‚  â””â”€ README.md

â”œâ”€ event-bus/
â”‚  â”œâ”€ adapters/
â”‚  â”‚  â””â”€ index.ts
â”‚  â”œâ”€ event-bus.service.ts
â”‚  â”œâ”€ event.types.ts
â”‚  â””â”€ README.md
â”‚
â”œâ”€ workflow/
â”‚  â”œâ”€ workflow.engine.ts
â”‚  â”œâ”€ workflow.registry.ts
â”‚  â”œâ”€ steps/
â”‚  â”‚  â””â”€ index.ts
â”‚  â””â”€ README.md
â”‚
â”œâ”€ audit/
â”‚  â”œâ”€ audit-log.entity.ts
â”‚  â”œâ”€ audit-log.service.ts
â”‚  â”œâ”€ audit-policies.ts
â”‚  â””â”€ README.md
â”‚
â”œâ”€ policies/
â”‚  â”œâ”€ access-control.policy.ts
â”‚  â”œâ”€ approval.policy.ts
â”‚  â””â”€ README.md
â”‚
â””â”€ README.md
```

### 3.2 å¯¦ä½œéª¨æ¶ç¯„ä¾‹

#### 3.2.1 Facade ç¯„ä¾‹ï¼ˆAssetï¼‰

```typescript
// /blueprint/asset/facade/asset.facade.ts
import { AssetService } from '../services/asset.service';

export class AssetFacade {
  constructor(private readonly assetService: AssetService) {}

  async upload(file: any, ownerId: string, ownerType: string) {
    return this.assetService.upload(file, ownerId, ownerType);
  }
}
```

#### 3.2.2 Service ç¯„ä¾‹ï¼ˆAssetï¼‰

```typescript
// /blueprint/asset/services/asset.service.ts
import { CloudFacade } from '../../infrastructure/cloud/cloud.facade';

export class AssetService {
  constructor(private readonly cloud: CloudFacade) {}

  async upload(file: any, ownerId: string, ownerType: string) {
    // TODO: é©—è­‰ policy
    const cloudFile = await this.cloud.uploadFile({ file });
    // TODO: å»ºç«‹ Asset Entity / æ›´æ–°ç‹€æ…‹
    // TODO: ç™¼å¸ƒ asset.uploaded event
    return cloudFile;
  }
}
```

#### 3.2.3 EventBus èµ·æ‰‹å¼

```typescript
// /blueprint/event-bus/event-bus.service.ts
export class EventBusService {
  private subscribers: Record<string, Function[]> = {};

  publish(event: string, payload: any) {
    (this.subscribers[event] || []).forEach(fn => fn(payload));
  }

  subscribe(event: string, handler: Function) {
    if (!this.subscribers[event]) this.subscribers[event] = [];
    this.subscribers[event].push(handler);
  }
}
```

#### 3.2.4 Workflow Engine èµ·æ‰‹å¼

```typescript
// /blueprint/workflow/workflow.engine.ts
export class WorkflowEngine {
  execute(workflowId: string, context: any) {
    // TODO: æ ¹æ“š workflow steps åŸ·è¡Œ
  }
}
```

#### 3.2.5 Audit èµ·æ‰‹å¼

```typescript
// /blueprint/audit/audit-log.service.ts
export class AuditLogService {
  log(action: string, entityId: string, userId: string, data?: any) {
    console.log(`[AUDIT] ${action} by ${userId} on ${entityId}`, data);
  }
}
```

### 3.3 Blueprint Layer è²¬ä»»é‚Šç•Œ

| å±¤ç´š / è³‡æº | è²¬ä»» |
|------------|------|
| modules/ | å…·é«”æ¥­å‹™æ¨¡çµ„ï¼ŒDomain èšåˆæ ¹ã€ç‹€æ…‹ã€è¦å‰‡ã€äº‹ä»¶ã€Facadeã€‚åªèƒ½ä¾è³´ Blueprint å…§çš„å…¶ä»–æ¨¡çµ„æˆ– Infrastructure Facadeï¼ˆCloudã€Queueã€AIï¼‰ã€‚ |
| asset/ | æª”æ¡ˆ / é™„ä»¶æ¨¡çµ„ã€‚è² è²¬æª”æ¡ˆç”Ÿå‘½é€±æœŸã€ç‹€æ…‹ã€æ”¿ç­–ã€‚å‘¼å« CloudFacade å„²å­˜/è®€å–ã€‚ |
| event-bus/ | Domain Event Dispatcherã€‚è² è²¬äº‹ä»¶ç™¼å¸ƒèˆ‡è¨‚é–±ã€‚äº‹ä»¶ç”± Domain å±¤ç”¢ç”Ÿï¼Œä¸æ‡‰æœ‰æ¥­å‹™é‚è¼¯ã€‚ |
| workflow/ | å·¥ä½œæµç¨‹ç·¨æ’å™¨ã€‚å®šç¾©æµç¨‹æ­¥é©Ÿã€ç‹€æ…‹è½‰ç§»ã€äº‹ä»¶è§¸ç™¼ï¼ŒåŸ·è¡Œ Domain Serviceã€‚ |
| audit/ | ç³»çµ±ç¨½æ ¸ã€‚è² è²¬ç´€éŒ„æ‰‹å‹•æ“ä½œã€ç‹€æ…‹è®Šæ›´ã€äº‹ä»¶è§¸ç™¼ï¼Œå¯è¢«å„æ¨¡çµ„å‘¼å«ã€‚ |
| policies/ | è·¨æ¨¡çµ„ç­–ç•¥ã€‚åŒ…å«å­˜å–æ§åˆ¶ã€å¯©æ ¸ç­–ç•¥ç­‰ï¼Œæ¨¡çµ„å…§ç­–ç•¥åªç®¡æ¨¡çµ„å…§è¦å‰‡ï¼Œä¸ç®¡è·¨æ¨¡çµ„æµç¨‹ã€‚ |

### 3.4 äº‹ä»¶æµç¯„ä¾‹ï¼ˆContract PDF ä¸Šå‚³ï¼‰

```
ContractFacade.uploadContractPDF(file)
    â†“
AssetFacade.upload(file)
    â†“
AssetService.validatePolicy()
    â†“
CloudFacade.uploadFile()
    â†“
AssetService.updateAssetStatus()
    â†“
event-bus.emit('asset.uploaded')
    â†“
ContractService.onAssetUploaded()
```

**é—œéµé»ï¼š**
- Contract ä¸å­˜æª”æ¡ˆï¼Œåªå­˜ AssetId
- Asset æ¨¡çµ„è² è²¬æª”æ¡ˆç‹€æ…‹ç®¡ç†
- CloudFacade å®Œå…¨ä¸èªè­˜ Domain
- äº‹ä»¶ç”± Blueprint Domain ç™¼å¸ƒåˆ° event-bus

### 3.5 å»ºè­°é–‹ç™¼è¦ç¯„

1. æ¨¡çµ„ä¹‹é–“åªé€é Facade + EventBus é€šè¨Š
2. æ‰€æœ‰ Domain Event å¿…é ˆç”±æ¨¡çµ„ Service ç™¼å¸ƒ
3. Cloud / AI / Queue / Notification çµ±ä¸€ç¶“ç”± Infrastructure Facade
4. Asset / File æ˜¯ Blueprint Domainï¼Œä¸ç›´æ¥ä¾è³´ Contract / Task / Issue
5. Audit / Policy / Workflow é›†ä¸­ç®¡ç†ï¼ŒDomain Service å‘¼å«å³å¯

---

## çµèª

### æœ¬æ–‡ä»¶å®šç¾©çš„æ˜¯ï¼š

- **è·¨æ¨¡çµ„æµç¨‹å”èª¿**
- **ç³»çµ±ç´šè¦å‰‡èˆ‡ç­–ç•¥**
- **äº‹ä»¶åŒ¯æµæ’æ¶æ§‹**
- **å·¥ä½œæµç¨‹å®šç¾©**
- **ç¨½æ ¸èˆ‡å¯©è¨ˆæ©Ÿåˆ¶**

### ä¸æè¿°ï¼š

- å–®ä¸€æ¨¡çµ„å…§éƒ¨å¯¦ä½œ
- æ¨¡çµ„è³‡æ–™çµæ§‹
- UI å¯¦ä½œç´°ç¯€

### æ­¤æ–‡ä»¶å¯ä½œç‚ºï¼š

- Blueprint æ¶æ§‹è—åœ–
- è·¨æ¨¡çµ„æµç¨‹è¨­è¨ˆä¾æ“š
- ç³»çµ±æ•´åˆé©—æ”¶åŸºæº–
- äº‹ä»¶èˆ‡å·¥ä½œæµç¨‹è¦ç¯„

---

## æœ€é‡è¦çš„æé†’

> **Blueprint Layer æ°¸é ä¸æ‡‰è©²çŸ¥é“ã€Œè³‡æ–™é•·ä»€éº¼æ¨£å­ã€ï¼ŒåªçŸ¥é“ã€Œäº‹ä»¶ã€è¦å‰‡èˆ‡æµç¨‹ã€ã€‚**

---
