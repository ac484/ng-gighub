# Contract Module Architecture

> åˆç´„æ¨¡çµ„æ¶æ§‹è¦–è¦ºåŒ–èªªæ˜

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Interface Layer                      â”‚
â”‚  (contract-module-view-refactored.component.ts)                 â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  List    â”‚  â”‚ Preview  â”‚  â”‚ Parsing  â”‚  â”‚  Upload  â”‚       â”‚
â”‚  â”‚ Feature  â”‚  â”‚  Modal   â”‚  â”‚  Modal   â”‚  â”‚  Step    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ inject()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Business Logic Layer                         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ContractFacade   â”‚  â”‚ ContractService  â”‚  â”‚ AI Parser    â”‚ â”‚
â”‚  â”‚ (Orchestrator)   â”‚  â”‚ (Business Logic) â”‚  â”‚   Service    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“ inject()                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Upload Service   â”‚  â”‚ File Processor   â”‚  â”‚ Contract     â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚    Service       â”‚  â”‚  Store       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ inject()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Access Layer                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             ContractRepository (Phase 4)                  â”‚  â”‚
â”‚  â”‚  - listContracts()                                        â”‚  â”‚
â”‚  â”‚  - createContract()                                       â”‚  â”‚
â”‚  â”‚  - updateContract()                                       â”‚  â”‚
â”‚  â”‚  - deleteContract()                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Firebase Services                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Firestore    â”‚  â”‚     Storage    â”‚  â”‚  Cloud Functions â”‚  â”‚
â”‚  â”‚  (Contracts)   â”‚  â”‚   (Files)      â”‚  â”‚  - storage       â”‚  â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚  - ai-document   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š è³‡æ–™æµç¨‹åœ–

### 1. æª”æ¡ˆä¸Šå‚³æµç¨‹

```
User Action                                Cloud Function
    â”‚                                          â”‚
    â”œâ”€> Select File                            â”‚
    â”‚                                          â”‚
    â”œâ”€> ContractUploadService                 â”‚
    â”‚   â””â”€> uploadBytesResumable()            â”‚
    â”‚       â””â”€> Firebase Storage               â”‚
    â”‚           â””â”€> /contracts/{bp}/{c}/originals/file.pdf
    â”‚                                          â”‚
    â”‚                                          â†“
    â”‚                                   onObjectFinalized
    â”‚                                   (functions-storage)
    â”‚                                          â”‚
    â”‚                                          â”œâ”€> Validate File
    â”‚                                          â”œâ”€> Extract Metadata
    â”‚                                          â”œâ”€> Scan for Malware
    â”‚                                          â””â”€> Write to Firestore
    â”‚                                              â””â”€> /blueprints/{bp}/files/{fileId}
    â”‚                                          
    â†“                                          â”‚
ContractFileProcessorService                   â”‚
    â””â”€> onSnapshot(fileDoc)                    â”‚
        â””â”€> Listen for processed=true <â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â””â”€> Update UI
                â””â”€> Show "Processing Complete"
```

### 2. é è¦½æµç¨‹

```
User Action          Component                    External Service
    â”‚                   â”‚                              â”‚
    â”œâ”€> Click Preview   â”‚                              â”‚
    â”‚                   â”‚                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> handlePreviewContract()          â”‚
                        â”‚                              â”‚
                        â”œâ”€> Get fileUrl               â”‚
                        â”‚                              â”‚
                        â””â”€> Open Modal                â”‚
                            â””â”€> ContractPreviewModal  â”‚
                                â”‚                      â”‚
                                â””â”€> Load iframe â”€â”€â”€â”€â”€â”€>â”‚
                                    with Google Docs   â”‚
                                    Viewer URL         â”‚
                                                       â”‚
                                    https://docs.google.com/viewer?
                                    url={fileUrl}&embedded=true
```

### 3. AI è§£ææµç¨‹

```
User Action          Component              Cloud Function          Document AI
    â”‚                   â”‚                         â”‚                     â”‚
    â”œâ”€> Click Parse     â”‚                         â”‚                     â”‚
    â”‚                   â”‚                         â”‚                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> handleParseContract()       â”‚                     â”‚
                        â”‚                         â”‚                     â”‚
                        â””â”€> ContractAIParserService                    â”‚
                            â”‚                     â”‚                     â”‚
                            â”œâ”€> convertToGcsUri() â”‚                     â”‚
                            â”‚                     â”‚                     â”‚
                            â””â”€> httpsCallable() â”€â”€>â”‚                     â”‚
                                processDocumentFromStorage             â”‚
                                                  â”‚                     â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚
                                                  Process PDF           â”‚
                                                  Extract Entities      â”‚
                                                  Return JSON     <â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â””â”€> transformToContractData()
                            â”‚
                            â””â”€> Open ParsingResultModal
                                â”‚
                                â”œâ”€> Display Confidence
                                â”œâ”€> Show Editable Form
                                â””â”€> User Reviews/Edits
                                    â”‚
                                    â””â”€> Accept
                                        â”‚
                                        â””â”€> Update Contract
                                            in Firestore
```

---

## ğŸ”„ ç‹€æ…‹ç®¡ç†æ¶æ§‹

### Signal-based State Management

```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ContractFacade                           â”‚
â”‚  (State Orchestrator)                                       â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Private Writable Signals                            â”‚   â”‚
â”‚  â”‚  - _blueprintId = signal<string | null>(null)      â”‚   â”‚
â”‚  â”‚  - _initialized = signal(false)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Public Readonly Signals                             â”‚   â”‚
â”‚  â”‚  - blueprintId = _blueprintId.asReadonly()         â”‚   â”‚
â”‚  â”‚  - initialized = _initialized.asReadonly()         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ContractStore                            â”‚
â”‚  (Shared State)                                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Private Writable Signals                            â”‚   â”‚
â”‚  â”‚  - _contracts = signal<Contract[]>([])             â”‚   â”‚
â”‚  â”‚  - _loading = signal(false)                         â”‚   â”‚
â”‚  â”‚  - _error = signal<string | null>(null)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Public Readonly Signals                             â”‚   â”‚
â”‚  â”‚  - contracts = _contracts.asReadonly()             â”‚   â”‚
â”‚  â”‚  - loading = _loading.asReadonly()                 â”‚   â”‚
â”‚  â”‚  - error = _error.asReadonly()                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Computed Signals                                    â”‚   â”‚
â”‚  â”‚  - statistics = computed(() => {                   â”‚   â”‚
â”‚  â”‚      return calculateStats(contracts());           â”‚   â”‚
â”‚  â”‚    })                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ consumed by
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Components                            â”‚
â”‚  (Read-only Access)                                         â”‚
â”‚                                                              â”‚
â”‚  template: `                                                â”‚
â”‚    @if (loading()) {                                        â”‚
â”‚      <nz-spin />                                            â”‚
â”‚    }                                                         â”‚
â”‚    @for (contract of contracts(); track contract.id) {     â”‚
â”‚      <app-contract-item [contract]="contract" />           â”‚
â”‚    }                                                         â”‚
â”‚  `                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ¨¡çµ„ä¾è³´é—œä¿‚

```
contract-module-view-refactored.component.ts (Orchestrator)
    â”‚
    â”œâ”€> ContractFacade (State Management)
    â”‚   â””â”€> ContractStore (Shared State)
    â”‚       â””â”€> ContractService (Business Logic)
    â”‚           â””â”€> ContractRepository (Data Access) [Phase 4]
    â”‚               â””â”€> Firestore
    â”‚
    â”œâ”€> ContractUploadService (File Upload)
    â”‚   â””â”€> Firebase Storage
    â”‚
    â”œâ”€> ContractFileProcessorService (Processing Status)
    â”‚   â””â”€> Firestore (onSnapshot)
    â”‚
    â””â”€> ContractAIParserService (AI Parsing)
        â””â”€> Cloud Functions (httpsCallable)
            â””â”€> functions-ai-document
                â””â”€> Document AI
```

---

## ğŸ¯ Feature æ¨¡çµ„çµæ§‹

```
contract/
â”œâ”€â”€ contract-module-view-refactored.component.ts  (Main Orchestrator)
â”‚
â”œâ”€â”€ features/                                      (Feature Modules)
â”‚   â”œâ”€â”€ list/
â”‚   â”‚   â”œâ”€â”€ contract-list.component.ts
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â”œâ”€â”€ contract-table.component.ts       (Shows icons)
â”‚   â”‚       â”œâ”€â”€ contract-filters.component.ts
â”‚   â”‚       â””â”€â”€ contract-statistics.component.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ preview/                                   [NEW - Phase 2]
â”‚   â”‚   â”œâ”€â”€ contract-preview-modal.component.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ parsing/                                   [NEW - Phase 3]
â”‚   â”‚   â”œâ”€â”€ contract-parsing-result-modal.component.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ upload/
â”‚   â”‚   â””â”€â”€ contract-upload-step.component.ts     [MODIFY - Phase 2]
â”‚   â”‚
â”‚   â”œâ”€â”€ detail/
â”‚   â”‚   â””â”€â”€ contract-detail-drawer.component.ts
â”‚   â”‚
â”‚   â””â”€â”€ edit/
â”‚       â””â”€â”€ contract-edit-modal.component.ts
â”‚
â””â”€â”€ shared/                                        (Shared Components)
    â””â”€â”€ components/
        â””â”€â”€ contract-status-badge.component.ts
```

---

## ğŸ” å®‰å…¨å±¤æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Firebase Authentication                            â”‚
â”‚  - User must be authenticated (request.auth != null)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Firebase Storage Rules                             â”‚
â”‚  - Blueprint membership check                               â”‚
â”‚  - File size validation (< 10MB)                           â”‚
â”‚  - File type validation (PDF, JPG, PNG)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Cloud Function (functions-storage)                 â”‚
â”‚  - Server-side file validation                              â”‚
â”‚  - Malware scanning                                         â”‚
â”‚  - Metadata extraction                                      â”‚
â”‚  - Content-type verification                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Firestore Security Rules                           â”‚
â”‚  - Contract read/write permissions                          â”‚
â”‚  - Blueprint membership verification                        â”‚
â”‚  - Role-based access control                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 5: Application Logic                                  â”‚
â”‚  - UI-level permission checks                               â”‚
â”‚  - Conditional button display                               â”‚
â”‚  - User-friendly error messages                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é–‹ç™¼åŸå‰‡å°ç…§

### é«˜å…§èšæ€§ (High Cohesion)

```
âœ… ç›¸é—œåŠŸèƒ½çµ„ç¹”åœ¨åŒä¸€ feature ä¸­
preview/
  â””â”€â”€ contract-preview-modal.component.ts  (All preview logic here)

parsing/
  â””â”€â”€ contract-parsing-result-modal.component.ts  (All parsing UI here)
```

### ä½è€¦åˆæ€§ (Low Coupling)

```
âœ… Features é€éæ˜ç¢ºæ¥å£æºé€š
ContractListComponent
  @Output() previewContract = output<Contract>()
  @Output() parseContract = output<Contract>()
      â†“
ContractModuleView (Orchestrator)
  handlePreviewContract(contract: Contract)
  handleParseContract(contract: Contract)
```

### å¯æ“´å±•æ€§ (Extensibility)

```
âœ… æ˜“æ–¼æ–°å¢ features æˆ–æ“´å±•ç¾æœ‰åŠŸèƒ½

æ–°å¢ "ç°½æ ¸" Feature:
contract/features/approval/
  â”œâ”€â”€ contract-approval-modal.component.ts
  â”œâ”€â”€ components/
  â”‚   â””â”€â”€ approval-form.component.ts
  â””â”€â”€ index.ts

åœ¨ Orchestrator æ•´åˆ:
handleApprovalContract(contract: Contract): void {
  this.approvalModal.open(contract);
}
```

---

## ğŸ§ª æ¸¬è©¦æ¶æ§‹

```
Unit Tests
    â”‚
    â”œâ”€> Services
    â”‚   â”œâ”€> ContractUploadService.spec.ts
    â”‚   â”œâ”€> ContractAIParserService.spec.ts
    â”‚   â””â”€> ContractFileProcessorService.spec.ts
    â”‚
    â”œâ”€> Components
    â”‚   â”œâ”€> contract-preview-modal.component.spec.ts
    â”‚   â””â”€> contract-parsing-result-modal.component.spec.ts
    â”‚
    â””â”€> Facades
        â””â”€> contract.facade.spec.ts

Integration Tests
    â”‚
    â””â”€> contract.integration.spec.ts
        â”œâ”€> Upload â†’ Cloud Function â†’ Firestore
        â”œâ”€> Preview â†’ Modal â†’ Google Docs Viewer
        â””â”€> Parse â†’ Cloud Function â†’ Modal â†’ Update

E2E Tests
    â”‚
    â””â”€> contract.e2e-spec.ts
        â”œâ”€> Complete upload workflow
        â”œâ”€> Complete preview workflow
        â””â”€> Complete AI parsing workflow
```

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0  
**æœ€å¾Œæ›´æ–°**: 2025-12-19  
**ç¶­è­·è€…**: GigHub Development Team
